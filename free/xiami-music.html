<h1 id="title">解密虾米音乐下载地址</h1>
<time id="date" datetime="2014-07-15T11:06:34+08:00">2014-07-15 11:06</time>
<section id="content">
    <p>
        本文讲述的是凯撒密码的其中一种，内容含有前辈的一些解密方法，&nbsp;半转载
    </p>
    <p>目标：虾米音乐网</p>
    <p>
        分析一下这首歌，地址是：&nbsp;http://www.xiami.com/song/&nbsp;1769397120<br />歌曲ID为：
        1769397120
    </p>
    <p>
        请求XML地址：&nbsp;http://www.xiami.com/song/playlist/id/1769397120
        （此处是歌曲ID） /object_name/default/object_id/0
    </p>
    <figure
        id="attachment_162"
        aria-describedby="caption-attachment-162"
        style="width: 219px"
        class="wp-caption alignnone"
    >
        <a
            href="https://laod.cn/wp-content/uploads/2014/07/xiami.jpg"
            rel="https://laod.cn"
            ><noscript
                ><img
                    class="wp-image-162 size-full"
                    title="破解虾米音乐"
                    src="https://laod.cn/wp-content/uploads/2014/07/xiami.jpg"
                    alt="破解虾米音乐"
                    width="219"
                    height="220" /></noscript
            ><img
                class="wp-image-162 size-full j-lazy"
                title="破解虾米音乐"
                src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20219%20220'%3E%3C/svg%3E"
                data-original="https://laod.cn/wp-content/uploads/2014/07/xiami.jpg"
                alt="破解虾米音乐"
                width="219"
                height="220"
                data-lazy-src="https://laod.cn/wp-content/themes/justnews/themer/assets/images/lazy.png" /><noscript
                ><img
                    class="wp-image-162 size-full j-lazy"
                    title="破解虾米音乐"
                    src="https://laod.cn/wp-content/themes/justnews/themer/assets/images/lazy.png"
                    data-original="https://laod.cn/wp-content/uploads/2014/07/xiami.jpg"
                    alt="破解虾米音乐"
                    width="219"
                    height="220" /></noscript
        ></a>
        <figcaption id="caption-attachment-162" class="wp-caption-text">
            破解虾米音乐
        </figcaption>
    </figure>
    <p>得出XML内容如下：</p>
    <pre class="lang:default decode:true" title="XML内容">
&lt;playlist xmlns="http://xspf.org/ns/0/" version="1"&gt;
&lt;trackList&gt;
&lt;track&gt;
&lt;title&gt;
&lt;![CDATA[ We The People ]]&gt;
&lt;/title&gt;
&lt;song_id&gt;1769397120&lt;/song_id&gt;
&lt;album_id&gt;370721&lt;/album_id&gt;
&lt;album_name&gt;
&lt;![CDATA[ Everlasting Truth ]]&gt;
&lt;/album_name&gt;
&lt;object_id&gt;1&lt;/object_id&gt;
&lt;object_name&gt;default&lt;/object_name&gt;
&lt;insert_type&gt;1&lt;/insert_type&gt;
&lt;background&gt;[img]http://img.xiami.net/res/player/bimg/bg-5.jpg[/img]&lt;/background&gt;
&lt;grade&gt;-1&lt;/grade&gt;
&lt;artist&gt;
&lt;![CDATA[ Re:plus;Pismo ]]&gt;
&lt;/artist&gt;
&lt;location&gt;
8h2fmF17274.u3dadd-%EltFii55%F17mtDa8bb15-lt%l.335123ph%eaea3E%p2ec44E7%23_5%6ee9%5%F.o%%7657%kE53%925E3mxm2229E33e7E55f3E-A5i%FF13__Fy9e5E43%n%.a273%92la%eb6b865u
&lt;/location&gt;
&lt;ms/&gt;
&lt;lyric&gt;[url]http://www.xiami.com/song/lyrictxt/id/1769397120&lt;/lyric&gt;[/url]
&lt;pic&gt;
[url]http://img.xiami.net/images/album/img34/71534/3707211328600624_1.jpg[/url]
&lt;/pic&gt;
&lt;length&gt;206&lt;/length&gt;
&lt;tryhq&gt;0&lt;/tryhq&gt;
&lt;artist_id&gt;71534&lt;/artist_id&gt;
&lt;rec_note/&gt;
&lt;/track&gt;
&lt;/trackList&gt;
&lt;lastSongId/&gt;
&lt;type&gt;default&lt;/type&gt;
&lt;type_id&gt;1&lt;/type_id&gt;
&lt;clearlist/&gt;
&lt;vip&gt;0&lt;/vip&gt;
&lt;vip_role&gt;0&lt;/vip_role&gt;
&lt;hqset&gt;0&lt;/hqset&gt;
&lt;/playlist&gt;</pre
    >
    <p>
        <span style="color: #2a2a2a">歌曲信息在内，然而，下载地址被加密：</span>
    </p>
    <pre class="lang:default decode:true">
&lt;location&gt;
8h2fmF17274.u3dadd-%EltFii55%F17mtDa8bb15-lt%l.335123ph%eaea3E%p2ec44E7%23_5%6ee9%5%F.o%%7657%kE53%925E3mxm2229E33e7E55f3E-A5i%FF13__Fy9e5E43%n%.a273%92la%eb6b865u
&lt;/location&gt;</pre
    >
    <p style="color: #2a2a2a">加密方法使用的就是凯撒加密，我们如何去解开呢？</p>
    <p style="color: #2a2a2a">
        这串字符串中，把第一个字符 8
        拿出来，然后把剩余的字符串分为四部分，若能整除则每部分都一样长，若不能整除，则后余数个字符串少一个字符，这里拆开后为：
    </p>
    <pre class="lang:default decode:true">
[ h2fmF17274.u3dadd-%EltFii55%F17mtDa8bb15-lt%l.335123ph%eaea3E%p2ec44E7%23_5%6ee9%5%F.o%%7657%kE53%925E3mxm2229E33e7E55f3E-A5i%FF13__Fy9e5E43%n%.a273%92la%eb6b865u ]</pre
    >
    <p style="color: #2a2a2a">
        一共78个字符 8-78%4 =
        2,因此数列为[20,20,19,19].然后从第一个字符串的第一个字符开始拼接，若把这个拆分后的字符串数组看成一个二维的字符数组，拼接方式为
        [0][0],[1][0],[2][0],[3][0],[4][0],[0][1],[1][1],[2][1],[3][1][4][1]…
        拼完之后就是下载的真实地址，最后把^替换为字符0.
    </p>
    <p style="color: #2a2a2a">
        前辈的这段文字说明，只是把播放地址给解码出来了，可是还少了一个auth_key，为什么会少了auth_key呢？
        原因是上述的解码方式算法有误。&nbsp;&nbsp;我个人认为是这样的。
    </p>
    <pre class="lang:default decode:true">
/*
虾米音乐下载地址，凯撒数列加密方式。
解密算法。
BY 老D www.laod.cn

XXX.php?id=歌曲ID
*/

 &lt;?php
function u($t) {
$l = substr($t,0,1); 
$t = substr($t, 1);	
$tn = strlen($t);	
$ln = $tn / $l;	
$r = $tn % $l;	
$res = array();
for($i=0;$i&lt;$l;$i++) { 
if($i&lt;$r) $e = $ln+1;
else $e = $ln;
$m = substr($t, 0, $e);
$res[] = str_split($m);
$t = substr($t, $e);
}
$text = '';
for($i=0;$i&lt;$ln;$i++) {
for($j=0;$j&lt;$l;$j++) {
if(isset($res[$j][$i])) $text .= $res[$j][$i];
else break;
}
}
return str_replace('^', 0, urldecode($text));
}
function ua($t) {
$l = substr($t,0,1);
$t = substr($t, 1);
$tn = strlen($t);
$ln = floor($tn/$l);
$r = $tn % $l;
$tex = str_split($t);
$text = '';
for($i=0;$i&lt;=$ln;$i++) {
for($j=0;$j&lt;$l;$j++) {
$n = $j*$ln+$i;
if($j&lt;$r) $n += $j;
else $n += $r;
if(isset($tex[$n])) $text .= $tex[$n];
else break;
}
}
$preg = array('^', '%');
$replace = array(0, '|');
return str_replace($preg, $replace, urldecode(substr($text, 0, $tn)));
}
function callback($text) {
if(isset($_GET['callback'])) {
return $_GET['callback'] . '(' . $text . ')';
} else {
return $text;
}
}
if(!isset($_GET['id'])) die('lack of the id parameter');
$xml = simplexml_load_file('http://www.xiami.com/song/playlist/id/'.$_GET['id']);
$track = $xml-&gt;trackList-&gt;track;
$song = array('id' =&gt; (string) $track-&gt;song_id,
  'title' =&gt; (string) $track-&gt;title,
  'artist' =&gt; (string) $track-&gt;artist,
  'location' =&gt; (string) ua($track-&gt;location),
  'lyric' =&gt; (string) $track-&gt;lyric,
  'pic' =&gt; (string) substr($track-&gt;pic,0, -5).'4.jpg'
  );
echo callback(json_encode($song));
?&gt;</pre
    >
    <p>
        <span style="color: #2a2a2a"
            >上面的是PHP版的最新虾米音乐地址 凯撒数列解码源代。
            欢迎大家在看完本文后帮忙补充本文的解码错误地方。谢谢！</span
        >
    </p>
    <div class="entry-copyright">
        <p>
            原创文章，作者：老D，如若转载，请注明出处：https://laod.cn/free/xiami-music.html
        </p>
    </div>
</section>
