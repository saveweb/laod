<h1 id="title">阿里云盾控制台 WordPress IP验证不当漏洞 解决方法</h1>
<time id="date" datetime="2019-04-13T13:56:46+08:00">2019-04-13 13:56</time>
<section id="content">
    <p>
        <a href="https://laod.cn/wp-content/uploads/2019/04/w0.jpg"
            ><noscript
                ><img
                    class="alignnone size-full wp-image-5960"
                    src="https://laod.cn/wp-content/uploads/2019/04/w0.jpg"
                    alt="WordPress IP验证不当漏洞"
                    width="600"
                    height="338" /></noscript
            ><img
                class="alignnone size-full wp-image-5960 j-lazy"
                src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20600%20338'%3E%3C/svg%3E"
                data-original="https://laod.cn/wp-content/uploads/2019/04/w0.jpg"
                alt="WordPress IP验证不当漏洞"
                width="600"
                height="338"
                data-lazy-src="https://laod.cn/wp-content/themes/justnews/themer/assets/images/lazy.png" /><noscript
                ><img
                    class="alignnone size-full wp-image-5960 j-lazy"
                    src="https://laod.cn/wp-content/themes/justnews/themer/assets/images/lazy.png"
                    data-original="https://laod.cn/wp-content/uploads/2019/04/w0.jpg"
                    alt="WordPress IP验证不当漏洞"
                    width="600"
                    height="338" /></noscript
        ></a>
    </p>
    <p>
        阿里云盾控制台漏洞提示wordpress IP验证不当漏洞，简介内容如下：wordpress
        /wp-includes/http.php文件中的wp_http_validate_url函数对输入IP验证不当，导致黑客可构造类似于012.10.10.10这样的畸形IP绕过验证，进行SSRF。
    </p>
    <p>
        <a href="https://laod.cn/wp-content/uploads/2019/04/w1.jpeg"
            ><noscript
                ><img
                    class="alignnone size-full wp-image-5961"
                    src="https://laod.cn/wp-content/uploads/2019/04/w1.jpeg"
                    alt="WordPress IP验证不当漏洞"
                    width="1200"
                    height="607" /></noscript
            ><img
                class="alignnone size-full wp-image-5961 j-lazy"
                src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%201200%20607'%3E%3C/svg%3E"
                data-original="https://laod.cn/wp-content/uploads/2019/04/w1.jpeg"
                alt="WordPress IP验证不当漏洞"
                width="1200"
                height="607"
                data-lazy-src="https://laod.cn/wp-content/themes/justnews/themer/assets/images/lazy.png" /><noscript
                ><img
                    class="alignnone size-full wp-image-5961 j-lazy"
                    src="https://laod.cn/wp-content/themes/justnews/themer/assets/images/lazy.png"
                    data-original="https://laod.cn/wp-content/uploads/2019/04/w1.jpeg"
                    alt="WordPress IP验证不当漏洞"
                    width="1200"
                    height="607" /></noscript
        ></a>
    </p>
    <p>
        关于wordpress
        IP验证不当漏洞的解决办法，首先我们需要把wordpress升级到最新版本。
    </p>
    <p>[mark_b]这里非常的有必要提醒下：</p>
    <p>
        请到<strong>wordpress国际站</strong>下载最新版：<a
            href="https://wordpress.org/download"
            target="_blank"
            rel="noopener noreferrer"
            ><strong> https://wordpress.org/download</strong></a
        >
    </p>
    <p>
        而不是wordpress中文官网（https://<strong>cn</strong>.wordpress.org/download/）
    </p>
    <p>因为种种原因，wordpress中文官网的版本会比国际站的更新慢好几个月。</p>
    <p>比如现在wordpress国际站的版本已经是5.1.1了，而中文站的版本是5.0.3</p>
    <p>如下图；整整慢了四个版本…</p>
    <p>
        <a href="https://laod.cn/wp-content/uploads/2019/04/w3.jpeg"
            ><noscript
                ><img
                    class="alignnone size-full wp-image-5962"
                    src="https://laod.cn/wp-content/uploads/2019/04/w3.jpeg"
                    alt="wordpress 历史版本"
                    width="800"
                    height="709" /></noscript
            ><img
                class="alignnone size-full wp-image-5962 j-lazy"
                src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20800%20709'%3E%3C/svg%3E"
                data-original="https://laod.cn/wp-content/uploads/2019/04/w3.jpeg"
                alt="wordpress 历史版本"
                width="800"
                height="709"
                data-lazy-src="https://laod.cn/wp-content/themes/justnews/themer/assets/images/lazy.png" /><noscript
                ><img
                    class="alignnone size-full wp-image-5962 j-lazy"
                    src="https://laod.cn/wp-content/themes/justnews/themer/assets/images/lazy.png"
                    data-original="https://laod.cn/wp-content/uploads/2019/04/w3.jpeg"
                    alt="wordpress 历史版本"
                    width="800"
                    height="709" /></noscript
        ></a>
    </p>
    <p>[/mark_b]</p>
    <p>然后做以下的修复操作即可。</p>
    <p>
        <a href="https://laod.cn/wp-content/uploads/2019/04/w5.jpeg"
            ><noscript
                ><img
                    class="alignnone size-full wp-image-5965"
                    src="https://laod.cn/wp-content/uploads/2019/04/w5.jpeg"
                    alt="http.php"
                    width="1200"
                    height="819" /></noscript
            ><img
                class="alignnone size-full wp-image-5965 j-lazy"
                src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%201200%20819'%3E%3C/svg%3E"
                data-original="https://laod.cn/wp-content/uploads/2019/04/w5.jpeg"
                alt="http.php"
                width="1200"
                height="819"
                data-lazy-src="https://laod.cn/wp-content/themes/justnews/themer/assets/images/lazy.png" /><noscript
                ><img
                    class="alignnone size-full wp-image-5965 j-lazy"
                    src="https://laod.cn/wp-content/themes/justnews/themer/assets/images/lazy.png"
                    data-original="https://laod.cn/wp-content/uploads/2019/04/w5.jpeg"
                    alt="http.php"
                    width="1200"
                    height="819" /></noscript
        ></a>
    </p>
    <p>&nbsp;</p>
    <p><strong>1、打开/wp-includes/http.php文件，在546行左右找到：</strong></p>
    <div class="dp-highlighter">
        <div class="bar"></div>
        <ol class="dp-c" start="1">
            <li class="alt">
                <span class="vars">$same_host</span>&nbsp;=&nbsp;<span
                    class="func"
                    >strtolower</span
                >(&nbsp;<span class="vars">$parsed_home</span
                >[‘host’]&nbsp;)&nbsp;===&nbsp;<span class="func"
                    >strtolower</span
                >(&nbsp;<span class="vars">$parsed_url</span>[‘host’]&nbsp;);
            </li>
        </ol>
    </div>
    <p>将其替换成：</p>
    <div class="dp-highlighter">
        <div class="bar"></div>
        <ol class="dp-c" start="1">
            <li class="alt">
                <span class="vars">$same_host</span>&nbsp;=&nbsp;(<span
                    class="func"
                    >strtolower</span
                >(<span class="vars">$parsed_home</span
                >[‘host’])&nbsp;===&nbsp;<span class="func">strtolower</span
                >(<span class="vars">$parsed_url</span
                >[‘host’])&nbsp;||&nbsp;‘localhost’&nbsp;===&nbsp;<span
                    class="func"
                    >strtolower</span
                >(<span class="vars">$parsed_url</span>[‘host’]));
            </li>
        </ol>
    </div>
    <p>&nbsp;</p>
    <p><strong>2、在文件大约563行左右找到：</strong></p>
    <div class="dp-highlighter">
        <div class="bar"></div>
        <ol class="dp-c" start="1">
            <li class="alt">
                <span class="keyword">if</span
                >&nbsp;(&nbsp;127&nbsp;===&nbsp;<span class="vars">$parts</span
                >[0]&nbsp;||&nbsp;10&nbsp;===&nbsp;<span class="vars"
                    >$parts</span
                >[0]&nbsp;||&nbsp;0&nbsp;===&nbsp;<span class="vars"
                    >$parts</span
                >[0]
            </li>
        </ol>
    </div>
    <p>将其替换成：</p>
    <div class="dp-highlighter">
        <div class="bar"></div>
        <ol class="dp-c" start="1">
            <li class="alt">
                <span class="keyword">if</span
                >&nbsp;(&nbsp;127&nbsp;===&nbsp;<span class="vars">$parts</span
                >[0]&nbsp;||&nbsp;10&nbsp;===&nbsp;<span class="vars"
                    >$parts</span
                >[0]&nbsp;||&nbsp;0&nbsp;===&nbsp;<span class="vars"
                    >$parts</span
                >[0]&nbsp;||&nbsp;0&nbsp;===&nbsp;<span class="vars"
                    >$parts</span
                >[0]
            </li>
        </ol>
    </div>
    <p>
        修改完以上内容，再到阿里云盾控制台重新验证一下漏洞，就会发现漏洞已经不存在了。
    </p>
    <div class="entry-copyright">
        <p>
            原创文章，作者：老D，如若转载，请注明出处：https://laod.cn/security/wordpress-ip-http.html
        </p>
    </div>
</section>
