<h1 id="title">JavaScript图片延迟加载微型库Echo.js</h1>
<time id="date" datetime="2017-04-22T11:36:56+08:00">2017-04-22 11:36</time>
<section id="content">
    <p>
        <a href="https://laod.cn/wp-content/uploads/2017/04/JavaScript.jpg"
            ><noscript
                ><img
                    class="alignnone size-full wp-image-3433"
                    src="https://laod.cn/wp-content/uploads/2017/04/JavaScript.jpg"
                    alt="JavaScript"
                    width="428"
                    height="252" /></noscript
            ><img
                class="alignnone size-full wp-image-3433 j-lazy"
                src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20428%20252'%3E%3C/svg%3E"
                data-original="https://laod.cn/wp-content/uploads/2017/04/JavaScript.jpg"
                alt="JavaScript"
                width="428"
                height="252"
                data-lazy-src="https://laod.cn/wp-content/themes/justnews/themer/assets/images/lazy.png" /><noscript
                ><img
                    class="alignnone size-full wp-image-3433 j-lazy"
                    src="https://laod.cn/wp-content/themes/justnews/themer/assets/images/lazy.png"
                    data-original="https://laod.cn/wp-content/uploads/2017/04/JavaScript.jpg"
                    alt="JavaScript"
                    width="428"
                    height="252" /></noscript
        ></a>
    </p>
    <p>
        Echo.js是一个标准的独立的Javascript图片懒加载（延迟加载）库，它非常小巧快速，只有2KB，它使用HTML5的
        data-*属性，延迟请求加载图片资源，不依赖任意第三方插件库，特别适用于移动端需要加载大量图片的应用。
    </p>
    <h4>如何使用</h4>
    <p>1、引入文件</p>
    <div class="dp-highlighter">
        <div class="bar"></div>
        <ol start="1" class="dp-j">
            <li class="alt">
                <span
                    ><span>&lt;script&nbsp;src=</span
                    ><span class="string">“js/echo.min.js”</span
                    ><span>&gt;&lt;/script&gt;&nbsp;&nbsp;</span></span
                >
            </li>
        </ol>
    </div>
    <p>2、HTML结构</p>
    <div class="dp-highlighter">
        <div class="bar"></div>
        <ol start="1" class="dp-j">
            <li class="alt">
                <span
                    ><span>&lt;img&nbsp;src=</span
                    ><span class="string">“img/blank.gif”</span
                    ><span>&nbsp;alt=</span><span class="string">“Photo”</span
                    ><span>&nbsp;data-echo=</span
                    ><span class="string">“img/photo.jpg”</span
                    ><span>&nbsp;/&gt;&nbsp;&nbsp;</span></span
                >
            </li>
        </ol>
    </div>
    <p>
        blank.gif 是一个 1 x 1 的图片，用做默认图片，data-echo
        的属性值是图片的真实地址。你可以给图片设置宽度和高度，或者在 CSS
        中设置，否则似乎很底部很底部的图片才会延迟加载。
    </p>
    <p>3、JavaScript</p>
    <div class="dp-highlighter">
        <div class="bar"></div>
        <ol start="1" class="dp-c">
            <li class="alt">
                <span><span>echo.init({&nbsp;&nbsp;</span></span>
            </li>
            <li class=""><span>offset:&nbsp;100,&nbsp;&nbsp;</span></li>
            <li class="alt"><span>throttle:&nbsp;250,&nbsp;&nbsp;</span></li>
            <li class="">
                <span
                    >unload:&nbsp;<span class="keyword">false</span
                    ><span>,&nbsp;&nbsp;</span></span
                >
            </li>
            <li class="alt">
                <span
                    >callback:&nbsp;<span class="keyword">function</span
                    ><span
                        >&nbsp;(element,&nbsp;op)&nbsp;{&nbsp;&nbsp;</span
                    ></span
                >
            </li>
            <li class="">
                <span>console.log(‘loaded&nbsp;ok.’);&nbsp;&nbsp;</span>
            </li>
            <li class="alt"><span>}&nbsp;&nbsp;</span></li>
            <li class=""><span>});&nbsp;&nbsp;</span></li>
        </ol>
    </div>
    <p>&nbsp;</p>
    <h4>常用参数及方法说明</h4>
    <table
        class="main_table"
        border="0"
        width="100%"
        cellspacing="0"
        cellpadding="0"
    >
        <thead>
            <tr class="table_title">
                <td>参数</td>
                <td>描述</td>
                <td>默认值</td>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>offset</td>
                <td>离可视区域多少像素的图片可以被加载</td>
                <td>0</td>
            </tr>
            <tr>
                <td>throttle</td>
                <td>图片延迟多少毫秒加载</td>
                <td>250</td>
            </tr>
            <tr>
                <td>debounce</td>
                <td>防抖动</td>
                <td>true</td>
            </tr>
            <tr>
                <td>unload</td>
                <td>
                    告诉echo是加载还是卸载视图中的图片，当图片离开视图区域时触发
                </td>
                <td>false</td>
            </tr>
            <tr>
                <td>callback</td>
                <td>回调函数，用来检测图片是否加载</td>
                <td>function()</td>
            </tr>
        </tbody>
    </table>
    <p>最后echo.js还提供了一个.render()方法，用法如下：</p>
    <div class="dp-highlighter">
        <ol start="1" class="dp-c">
            <li class="alt">
                <span><span>echo.render();&nbsp;&nbsp;</span></span>
            </li>
        </ol>
    </div>
    <p>
        应用场景：当你的页面没有发生滚动，而你想加载即将要显示的图片，如图片轮播，当第一张图片显示完，接着滑动展示第二张图片，这个时候使用<code>echo.render();</code>提前加载第二张图片，就不会出现图片加载卡顿白屏等现象。
    </p>
    <p>&nbsp;</p>
    <h4>Echo.js：</h4>
    <p>
        [cc lang=”js”]<br />/*! echo-js v1.7.3 | (c) 2016 @toddmotto |
        https://github.com/toddmotto/echo */<br />!function(t,e){“function”==typeof
        define&amp;&amp;define.amd?define(function(){return
        e(t)}):”object”==typeof
        exports?module.exports=e:t.echo=e(t)}(this,function(t){“use strict”;var
        e,n,o,r,c,a={},u=function(){},d=function(t){return
        null===t.offsetParent},l=function(t,e){if(d(t))return!1;var
        n=t.getBoundingClientRect();return
        n.right&gt;=e.l&amp;&amp;n.bottom&gt;=e.t&amp;&amp;n.left&lt;=e.r&amp;&amp;n.top&lt;=e.b},i=function(){(r||!n)&amp;&amp;(clearTimeout(n),n=setTimeout(function(){a.render(),n=null},o))};return
        a.init=function(n){n=n||{};var
        d=n.offset||0,l=n.offsetVertical||d,f=n.offsetHorizontal||d,s=function(t,e){return
        parseInt(t||e,10)};e={t:s(n.offsetTop,l),b:s(n.offsetBottom,l),l:s(n.offsetLeft,f),r:s(n.offsetRight,f)},o=s(n.throttle,250),r=n.debounce!==!1,c=!!n.unload,u=n.callback||u,a.render(),document.addEventListener?(t.addEventListener("scroll",i,!1),t.addEventListener("load",i,!1)):(t.attachEvent("onscroll",i),t.attachEvent("onload",i))},a.render=function(n){for(var
        o,r,d=(n||document).querySelectorAll("[data-echo],
        [data-echo-background]"),i=d.length,f={l:0-e.l,t:0-e.t,b:(t.innerHeight||document.documentElement.clientHeight)+e.b,r:(t.innerWidth||document.documentElement.clientWidth)+e.r},s=0;i&gt;s;s++)r=d[s],l(r,f)?(c&amp;&amp;r.setAttribute(“data-echo-placeholder”,r.src),null!==r.getAttribute(“data-echo-background”)?r.style.backgroundImage=”url(“+r.getAttribute(“data-echo-background”)+”)”:r.src!==(o=r.getAttribute(“data-echo”))&amp;&amp;(r.src=o),c||(r.removeAttribute(“data-echo”),r.removeAttribute(“data-echo-background”)),u(r,”load”)):c&amp;&amp;(o=r.getAttribute(“data-echo-placeholder”))&amp;&amp;(null!==r.getAttribute(“data-echo-background”)?r.style.backgroundImage=”url(“+o+”)”:r.src=o,r.removeAttribute(“data-echo-placeholder”),u(r,”unload”));i||a.detach()},a.detach=function(){document.removeEventListener?t.removeEventListener(“scroll”,i):t.detachEvent(“onscroll”,i),clearTimeout(n)},a});<br />[/cc]
    </p>
    <div class="entry-copyright">
        <p>
            原创文章，作者：老D，如若转载，请注明出处：https://laod.cn/page/javascript-echo-js.html
        </p>
    </div>
</section>
